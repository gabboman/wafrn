<mat-dialog-content style="padding: 12px">
  <h3 *ngIf="data?.post && !editing">In reply to:</h3>
  <div
    class="in-reply-to-preview quoted-post"
    *ngIf="data && data.post && !editing"
  >
    <div class="flex">
      <img class="avatar" [src]="data.post.user.avatar" alt="" />
      <div [innerHtml]="data.post.user.name"></div>
    </div>
    <app-post-fragment [fragment]="data.post"></app-post-fragment>
  </div>
  <h2 *ngIf="editing">
    You are editing your woot. Sorry you need to write all of it again.
  </h2>

  <quill-editor
    #quill
    class="w-full"
    [(ngModel)]="postCreatorContent"
    [modules]="modules"
    [customOptions]="customOptions"
  >
    <div
      quill-editor-toolbar
      class="post-editor-toolbar"
    >

    <span class="ql-align">
      <select class="ql-size" title="Text Size">
        <option value="small"></option>
        <option selected></option>
        <option value="large"></option>
        <option value="huge"></option>
      </select>
      <select class="ql-align">
        <option selected></option>
        <option value="center"></option>
        <option value="right"></option>
        <option value="justify"></option>
      </select>
      <select class="ql-color"></select>
      <select class="ql-background"></select>
    </span>
    <button type="button" class="ql-list" value="bullet" aria-label="List" title="List"
    ></button>
      <button
        type="button"
        class="ql-bold"
        aria-label="Bold"
        title="Bold"
      ></button>
      <button
        type="button"
        class="ql-italic"
        aria-label="Italic"
        title="Italic"
      ></button>
      <button
        type="button"
        class="ql-underline"
        aria-label="Underline"
        title="Underline"
      ></button>
      <button
        type="button"
        class="ql-strike"
        aria-label="Strike"
        title="Strike"
      ></button>
      <button
        type="button"
        class="ql-link"
        aria-label="Insert Link"
        title="Insert Link"
      ></button>
      <button
        type="button"
        class="ql-code-block"
        aria-label="Code block"
        title="Code block"
      ></button>
      <button
        type="button"
        class="ql-blockquote"
        aria-label="Quote"
        title="Quote"
      ></button>
      <button
        *ngIf="displayMarqueeButton"
        type="button"
        class="ql-marquee"
        aria-label="Marquee"
        title="Marquee"
      >
        M
      </button>
    </div>
  </quill-editor>
  <button
    mat-flat-button
    color="danger"
    *ngIf="postCreatorContent?.includes('<img')"
  >
    You somehow have pasted images in the editor. The image will NOT be visible
    once you woot. Please use the upload tool on the top bar of the editor
  </button>

  <div class="below-editor-toolbar">
    <div style="flex-grow: 1">
      <mat-form-field
        class="w-full"
        appearance="outline"
        subscriptSizing="dynamic"
      >
        <mat-label>Privacy</mat-label>
        <mat-select [required]="true" [(value)]="privacy">
          @if (privacyOption) {
          <mat-select-trigger>
            <fa-icon [icon]="privacyOption.icon"></fa-icon>
            {{ privacyOption.name }}
          </mat-select-trigger>
          } @for (option of privacyOptions; track option) {
          <mat-option [value]="option.level">
            <fa-icon [icon]="option.icon"></fa-icon>
            {{ option.name }}
          </mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
    <div class="cw-wrapper" [ngClass]="{ 'cw-animation': showContentWarning }">
      @if (showContentWarning || contentWarning) {
      <mat-form-field
        class="w-full"
        appearance="outline"
        subscriptSizing="dynamic"
      >
        <mat-label>Content warning</mat-label>
        <input [(ngModel)]="contentWarning" matNativeControl />
      </mat-form-field>
      }
      <mat-button-toggle
        *ngIf="!showContentWarning && !contentWarning"
        (change)="showContentWarning = !showContentWarning"
      >
        CW
      </mat-button-toggle>
    </div>
    <div class="w-full-mobile" *ngIf="uploadedMedias.length < 4 && pollQuestions.length === 0">
      <app-file-upload  (fileUpload)="uploadImage($event)"></app-file-upload>
    </div>
  </div>

  <section id="privacy-messages">
    <p *ngIf="privacy === 10" class="my-2">
      Attention! ADMINS both of your instance and the target instance can read
      the DMs
    </p>
    <p *ngIf="privacy === 3" class="my-2">
      Unlisted posts are posts that opt out of search, that including tag
      (hashtag) search in other instances. They are more public than followers
      only but less than regular public. I know I am great at explaining stuff
    </p>
  </section>
  <section *ngIf="false && uploadedMedias.length === 0" class="mt-3" id="pollControls">
    <button
          class="w-full"
          mat-button
          color="accent"
          (mousedown)="quoteOpen = true"
          mat-flat-button
        >
          add poll
        </button>
  </section>

  <section class="mt-3" id="avaiable-emojis">
    <mat-accordion>
    <mat-expansion-panel hideToggle>
      <mat-expansion-panel-header>
        <mat-panel-title>
          Avaiable Emojis
        </mat-panel-title>
      </mat-expansion-panel-header>
      You add search emojis in the post by writing the symbol : and a word for search. That will activate the emoji search
    </mat-expansion-panel>
  </mat-accordion>
  </section>

  <section id="uploaded-media">
    <div class="grid">
      <ng-container *ngFor="let media of uploadedMedias; let i = index">
        <div class="col-12 md:col-6 my-2 relative">
          <app-media-preview [media]="media"></app-media-preview>
          <mat-form-field class="w-full">
            <mat-label>Image Description</mat-label>
            <input
              placeholder="Description. Please FILL THIS"
              [(ngModel)]="media.description"
              type="text"
              matNativeControl
              required
              class="w-full"
            />
          </mat-form-field>
          <div>
            <mat-checkbox
              [disabled]="media.adultContent"
              [(ngModel)]="media.NSFW"
              class="w-full"
              >NSFW</mat-checkbox
            >
            <mat-checkbox
              class="w-full"
              (ngModelChange)="adultContentUpdated(i)"
              [(ngModel)]="media.adultContent"
              >Adult content</mat-checkbox
            >
            <button
              mat-mini-fab
              class="delete-btn"
              color="warn"
              (mousedown)="deleteImage(i)"
            >
              <fa-icon size="lg" [icon]="closeIcon"></fa-icon>
            </button>
          </div>
        </div>
      </ng-container>
    </div>
    <p class="my-2" *ngIf="uploadedMedias.length >= 4">
      Due some fediverse limitations, we can only have 4 medias per woot. Adding
      more would break how the woot is seen in other places. Sorry for the
      inconvenience
    </p>
    <p class="my-2" *ngIf="!allDescriptionsFilled()">
      Please fill the media descriptions. If you want to disable this check,
      there is an option in the profile that you can disable.
    </p>
  </section>

  <section id="quote">
    <div *ngIf="!data?.quote">
      <mat-spinner
        *ngIf="quoteLoading"
        class="my-4"
        color="accent"
        diameter="42"
      ></mat-spinner>
      @if (quoteOpen) {
      <mat-card class="p-2 my-4" *ngIf="!quoteLoading">
        <mat-form-field class="w-full">
          <mat-label>
            Paste the URL of a post to quote it. Can be the external url or the
            wafrn url
          </mat-label>
          <input
            [(ngModel)]="urlPostToQuote"
            placeholder="Just paste the post url"
            matNativeControl
          />
        </mat-form-field>
        <button
          (mousedown)="loadQuote()"
          mat-flat-button
          color="primary"
          class="w-full"
          [disabled]="urlPostToQuote === ''"
        >
          Add post as quote
        </button>
      </mat-card>
      } @else {
      <div class="flex justify-content-end my-2">
        <button
          class="w-full"
          mat-button
          color="primary"
          (mousedown)="quoteOpen = true"
          mat-flat-button
        >
          Add quote
        </button>
      </div>
      }
    </div>
    <div *ngIf="data && data.quote" class="my-4">
      <p class="mb-1">QUOTING:</p>
      <div class="quoted-post">
        <button
          mat-mini-fab
          class="delete-btn"
          color="warn"
          (mousedown)="data ? (data.quote = undefined) : null"
        >
          <fa-icon size="lg" [icon]="closeIcon"></fa-icon>
        </button>
        <div class="flex">
          <img class="avatar" [src]="data.quote.user.avatar" alt="" />
          <div [innerHtml]="data.quote.user.name"></div>
        </div>
        <app-post-fragment [fragment]="data.quote"></app-post-fragment>
      </div>
    </div>
  </section>

  <section id="tags" class="mt-2">
    <mat-form-field class="w-full">
      <mat-label>Tags</mat-label>
      <input
        [(ngModel)]="tags"
        placeholder="Separated by commas"
        matNativeControl
      />
    </mat-form-field>
    <div class="taglist">
      @for(tag of tags.split(','); track tag) {
      <span *ngIf="tag && tag !== '' && tag.trim() !== ''" class="tag">
        #{{ tag.trim() }}
      </span>
      }
    </div>
  </section>

  <button
    mat-flat-button
    color="accent"
    class="w-full mt-2"
    [disabled]="
      !allDescriptionsFilled() ||
      postBeingSubmitted ||
      (postCreatorContent === initialContent &&
        tags.length === 0 &&
        uploadedMedias.length === 0)
    "
    (mousedown)="submitPost()"
  >
    {{
      editing
        ? "Save woot"
        : idPostToReblog
        ? "Publish reply to woot"
        : "Publish woot"
    }}
  </button>
</mat-dialog-content>
