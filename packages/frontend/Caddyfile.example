{
    email ${{ACME_EMAIL}}

    log {

    }

    metrics {
        per_host
    }

    admin 0.0.0.0:2019

    on_demand_tls {
        ask http://pds:3000/tls-check
    }
}

${{MEDIA_DOMAIN}} {
    handle {
        root * /var/www/html/uploads/
        try_files {path} /index.html
        file_server
    }
}

${{CACHE_DOMAIN}} {
    handle /api/cache* {
        reverse_proxy ${{CACHE_HOST:-backend:9000}}
    }
}

${{DOMAIN_NAME}} {

    header * {
                ccess-Control-Allow-Origin: "*"
                Service-Worker-Allowed: "/",
                Cache-Control: no-cache, no-store, must-revalidate
        }
    @api path /api* /fediverse* /contexts* /post* /blog* /.well-known*

    handle @api {
        reverse_proxy backend:9000
    }

    handle_path /adminer* {
        reverse_proxy adminer:8080
    }

    handle {
        root * /var/www/html/frontend/
        try_files {path} /index.html
        file_server
    }
}

monitoring.${{DOMAIN_NAME}} {
    reverse_proxy grafana:2345
}

${{PDS_DOMAIN_NAME}} *.${{PDS_DOMAIN_NAME}} {
    tls {
        on_demand
    }

    reverse_proxy pds:3000
}
